<form action="/articles/new" method="post" enctype='application/json'>
    <input type="hidden" name="_csrf" value="{{csrfToken}}">
    <h3>Hlavn치 str치nka</h3>
    <label for="title">Nadpis</label>
    <br>
    <input type="text" name="title">
    <br>
    <label for="mainText">Popis</label>
    <br>
    <textarea name="mainText"></textarea>
    <br>
    <input type="hidden" name="dateOfCreate">
    <h2>Detail:</h2>
    <br>
    <div id="element">
        <input type="hidden" name="element">
    </div>
    <br>
    <select>
        <option value="add" selected="selected">Prida콘</option>
        <option value="subtitle">Podnadpis</option>
        <option value="text">Text</option>
        <option value="image">Obr치zok</option>
    </select>
    <br>
    <br>
    <button type="submit">Add Article</button>

</form>

<script>
    var today = new Date();
    var dd = today.getDate();
    if(dd<10)dd="0"+dd;
    var mm = today.getMonth()+1;
    if(mm<10)mm="0"+mm;
    var yyyy = today.getFullYear();
    var date = dd+"-"+mm+"-"+yyyy;
    $("input[name='dateOfCreate']").val(date);

    var getCount = function(){
    var  m =  ($("#element > input").length);
    var  n =  ($("#element > textarea").length);
        return m + n;
    }

    $( "select" )
            .change(function () {
                $( "select option:selected" ).each(function() {
                    switch(this.value){
                        case "add":

                            break;
                        case "subtitle":
                            $("select").val("add");
                            $('<label/>', {
                                for: 'subtitle'
                            }).text("Podnadpis").appendTo('#element');

                            $('<input/>',{
                                type: "text",
                                name: 'h2',
                                id:getCount()
                            }).appendTo('#element');
                            break;
                        case "text":
                            $("select").val("add");
                            $('<label/>', {
                                for: 'text'
                            }).text("Popis").appendTo('#element');

                            $('<textarea/>',{
                                name: 'p',
                                id:getCount()
                            }).appendTo('#element');
                            break;
                        case "image":
                            $("select").val("add");
                            $('<label/>', {
                                for: 'image'
                            }).text("Image").appendTo('#element');

                            $('<input/>',{
                                id:"image-upload",
                                type:"file",
                                name:"img",
                                id:getCount()
                            }).appendTo('#element');
                            break;

                    }
                });
            })
            .change();
    $('button').on('click',function () {
        var elementToSend = [];
        var g = $("#element > *").length;

        for(var j = 0; j < g; j++){
          var element =  $("#element").children().eq(j);
          if(element.attr('name') == "h2" || element.attr('name') == "p" ){
             var newElement = {
                 name: null,
                 path: null,
                 text: null
             };
             newElement.name = element.attr('name')+"";
             newElement.text = element.val()+"";
             elementToSend.push(newElement);
          }

        }
        for(var j = 0; j < g; j++){
            var element =  $("#element").children().eq(j);
            if(element.attr('name') == "h2" || element.attr('name') == "p" ){
                element.remove();
            }
        }
        $("input[name='element']").val(JSON.stringify(elementToSend));
    });
</script>